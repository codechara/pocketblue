### Install Fedora Atomic on mipad5

- **your current os and all your files will be deleted**
- you should have `bash`, `adb` and `fastboot` installed on your computer
- download image from [releases](https://github.com/pocketblue/pocketblue/releases/latest)
- unarchive it
- boot into fastboot and connect the device to your computer via usb
- make sure bootloader is unlocked
- run `bash flash_mipad5.sh`
- reboot and enjoy fedora

### Usage

- default username: `user`
- default password: `123456`
- to upgrade the system use `bootc upgrade` or `rpm-ostree upgrade`
- after that you should run `sudo ostree admin finalize-staged` to apply the ugrade
- this is required because the shutdown process is currently broken and may cause the system to freeze or crash
- all charging bugs are fixed now, enjoy working charging

### Rebasing to other desktops

- rebasing is a best way to try a new desktop
- before rebasing you should run `rpm-ostree reset`
- `sudo bootc switch quay.io/pocketblue/mipad5-gnome-desktop:42` - recommended image for mipad5
- `sudo bootc switch quay.io/pocketblue/mipad5-gnome-mobile:42`
- `sudo bootc switch quay.io/pocketblue/mipad5-plasma-desktop:42`
- `sudo bootc switch quay.io/pocketblue/mipad5-plasma-mobile:42`
- `sudo bootc switch quay.io/pocketblue/mipad5-phosh:42`
- after rebasing you should run `sudo ostree admin finalize-staged`

### Known bugs

- shutdown process is broken
- fell free to open issue and report any other bugs you find

### Uninstall fedora and get stock rom back

- download `MIUI 14.0.8.0.TKXMIXM` archive [from here](https://miuirom.org/tablets/xiaomi-pad-5)
- unarchive it
- run `bash flash_all.sh`
- reboot and enjoy stock rom
- no need for repartitioning or any other actions

### Files used by the installation script, license info, source links

- `root.raw` - root partition for fedora, built by `.github/workflows/images-mipad5.yml`
- `boot.raw` - /boot partition, built by `.github/workflows/images-mipad5.yml`
- `efi.raw` - /boot/efi partition, built by `.github/workflows/images-mipad5.yml`
- `uboot.img` - u-boot image, gpl2 license, [source](https://gitlab.com/sm8150-mainline/u-boot/-/jobs?kind=BUILD)
- `twrp.img` - recovery, gpl3 license, [source](https://github.com/ArKT-7/twrp_device_xiaomi_nabu)
- `dtbo.img` - device tree blob overlay image from lineage os, gpl2 or bsd‑2‑clause license, [source](https://github.com/ArKT-7/automated-nabu-lineage-installer)
- `vbmeta-disabled.img` - generated by `avbtool make_vbmeta_image --flags 2 --padding_size 4096 --output vbmeta_disabled.img` command
- `parted` - gnu parted arm64 static binary, gpl3 license, [source](https://github.com/pocketblue/parted-static)
- `sgdisk` - sgdisk arm64 static binary, gpl2 license, [source](https://github.com/pocketblue/sgdisk-static)

### Enabled copr repositories

- [@mobility/common](https://copr.fedorainfracloud.org/coprs/g/mobility/common) - [source](https://github.com/fedora-remix-mobility/packages), not required for mipad5, but required for other devices
- [onesaladleaf/pocketblue](https://copr.fedorainfracloud.org/coprs/onesaladleaf/pocketblue) - [source](https://github.com/pocketblue/packages)
- [gmanka/sm8150](https://copr.fedorainfracloud.org/coprs/gmanka/sm8150) - [source](https://github.com/pocketblue/sm8150)
- [@mobility/gnome-mobile](https://copr.fedorainfracloud.org/coprs/g/mobility/gnome-mobile) - only enabled in `quay.io/pocketblue/mipad5-gnome-mobile` image
