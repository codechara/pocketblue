#!/usr/bin/env bash

set -uexo pipefail

export device=@device@
# export device=enchilada # for oneplus6
# export device=fajita    # for oneplus6t

echo $device | grep -E 'enchilada|fajita'

which fastboot

fastboot getvar product 2>&1 | grep 'sdm845'
fastboot erase dtbo
fastboot erase op2 2> /dev/null || true
fastboot flash boot     images/uboot-$device.img --slot=all
fastboot flash system_a images/boot.raw
fastboot flash system_b images/esp.raw
fastboot flash userdata images/root.raw

echo 'done flashing, rebooting now'
fastboot reboot
