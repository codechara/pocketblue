@echo on
setlocal EnableExtensions EnableDelayedExpansion

set device=@device@
REM set device=enchilada # for oneplus6
REM set device=fajita    # for oneplus6t

where fastboot || (pause & exit)

echo 'waiting for device appear in fastboot'
fastboot getvar product 2>&1 | findstr /i sdm845 || (pause & exit)
fastboot erase dtbo_a || (pause & exit)
fastboot erase dtbo_b || (pause & exit)
fastboot flash boot     images/uboot-%device%.img --slot=all || (pause & exit)
fastboot flash system_a images/boot.raw || (pause & exit)
fastboot flash system_b images/esp.raw  || (pause & exit)
fastboot flash userdata images/root.raw || (pause & exit)

echo 'done flashing, rebooting now'
fastboot reboot
pause
